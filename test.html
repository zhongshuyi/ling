<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div class="relative markdown w-1/2" id="markdown">
      <h1 id="%E4%B8%80%E7%BA%A7%E6%A0%87%E9%A2%98" tabindex="-1">一级标题</h1>
      <h3 id="%E4%B8%89%E7%BA%A7" tabindex="-1">三级</h3>
      <h2 id="%E4%BA%8C%E7%BA%A7" tabindex="-1">二级</h2>
      <h3 id="第二个三级" tabindex="-1">第二个三级</h3>
      <h1 id="第二个一级" tabindex="-1">第二个一级</h1>
      <h2 id="%E7%AC%AC%E4%BA%8C%E4%B8%AA%E4%BA%8C%E7%BA%A7" tabindex="-1">第二个二级</h2>
      <h3 id="%E7%AC%AC%E4%BA%8C%E4%B8%AA%E4%B8%89%E7%BA%A7" tabindex="-1">第三个三级</h3>
      <h5 id="%E4%BA%94%E7%BA%A7" tabindex="-1">五级</h5>
      <h4 id="%E5%9B%9B%E7%BA%A7" tabindex="-1">四级</h4>
    </div>
  </body>
  <script>
    const log = console.log

    let h = document.getElementById('markdown').querySelectorAll('h1, h2, h3, h4, h5, h6')

    let getData = () => {
      let d = []
      h.forEach((element) => {
        d.push({
          id: element.getAttribute('id'),
          level: parseInt(element.tagName.replace('H', '')),
          title: element.innerText
        })
      })
      return d
    }

    let data = getData()

    let copyData = Object.assign([], data)

    let getChildren = (e) => {
      let children = []
      let beforeLevel = e.level
      for (let i = data.indexOf(e); i < data.length; i++) {
        if (data[i].level > e.level) {
          beforeLevel = data[i].level
          children.push(data[i])
        }
        if (e.level >= data[i].level && e != data[i]) {
          break
        }
      }
      for (let i = 0; i < children.length - 1; i++) {
        if (children[i].level < children[i + 1].level) {
          children.splice(i + 1, 1)
          i--
        }
      }
      return children
    }

    let getTree = (element, arr) => {
      var children = getChildren(element)
      element.children = children
      children.forEach((e) => {
        arr.splice(arr.indexOf(e), 1)
      })

      if (children.length === 0) {
        return
      } else {
        children.forEach((el) => {
          getTree(el, arr)
        })
      }
    }

    copyData.forEach((e) => {
      getTree(e, copyData)
    })
    log(copyData)
  </script>
</html>
